---
title: "ELN Naming Application"
author: "Alistair Grevis-James <alistair.grevis-james@csl.com.au>"
date: "25/01/2018"
output: html_document
runtime: shiny
---

# https://clipboardjs.com/

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, echo=FALSE}
#Adding the libraries
library(shiny)
library(data.tree)
library(rclipboard)
```

```{r, echo=FALSE}
#Creating the Root Node
D831 <- Node$new("D831")
```

```{r, echo=FALSE}
#Creating the Fundamental Technique Nodes

#HPLC
  FundamentalTechnique <- D831$AddChild("High Pressure Liquid Chromatography")
  FundamentalTechnique$tag <- 'HPLC'
    Methodology <- FundamentalTechnique$AddChild("Size Exclusion")
    Methodology$tag <- 'SE'
      Analyte <- Methodology$AddChild("Analyte")
      Analyte$tag <- ("A1")

#Electrophoresis
  FundamentalTechnique <- D831$AddChild("Electrophoresis")
  FundamentalTechnique$tag <- 'EP'
    Methodology <- FundamentalTechnique$AddChild("Size Exclusion")
    Methodology$tag <- 'SE'
      Analyte <- Methodology$AddChild("Analyte")
      Analyte$tag <- ("A1")
      
#Electrophoresis
  FundamentalTechnique <- D831$AddChild("Cell-Based")
  FundamentalTechnique$tag <- 'CB'
    Methodology <- FundamentalTechnique$AddChild("Size Exclusion")
    Methodology$tag <- 'SE'
      Analyte <- Methodology$AddChild("Analyte")
      Analyte$tag <- ("A1")


```

```{r, echo=FALSE}
#Printing the Tree
#print(D831)
#print(FundamentalTechnique$tag)
```

```{r, echo=FALSE}
#Adding the Projects
projects = c('', 'CSL689', 'CSL312', 'CSL346')
```

```{r, echo=FALSE}
# Create an empty c
techs = c('')
for (node in D831$children)
{ 
  techs <- c(techs, node$name) 
}

#Print list to confirm
#print(techs)
```


```{r, echo=FALSE}
# Define UI for application that draws a histogram
ui <- fluidPage(
   
   # Application title
   titlePanel("Proof of Concept Naming App"),
   
   # Sidebar with a slider input for number of bins 
   sidebarLayout(
      sidebarPanel(
         dateInput(
           inputId = "date",
           label = "Select Date of Analysis",
           value = Sys.Date(),
           format = "yyyy-mm-dd"),
         
         selectInput(inputId = "project",
                     label = "Select CSL Project",
                     choices = projects),
         
         selectInput(inputId = "technique",
                     label = "Select Fundamental Technique",
                     choices = techs),
         
         uiOutput("methodInput"),
         uiOutput("analyteInput"),
         uiOutput("stringInput"),
         width = 8),
      
      # Show a plot of the generated distribution
      mainPanel()
   )
)

# ADD COMMENT
server <- function(input, output) {
   
  output$methodInput <- renderUI({
    
    techName = input$technique
    techNode = Navigate(D831, techName)
    
    methods <- c('')
    for (node in techNode$children)
    { 
      methods <- c(methods, node$name) 
    }
    
    selectInput(inputId = "method",
                label = "Methodology",
                choices = methods
    )
    
  })
  
  output$analyteInput <- renderUI({
    
    techName = input$technique
    techNode = Navigate(D831, techName)
    
    methodName = input$method
    methodNode = Navigate(techNode, methodName)
    
    analytes <- c('')
    for (node in methodNode$children)
    { 
      analytes <- c(analytes, Analyte$name) 
    }
    
    selectInput(inputId = "analyte",
                label = "Analyte",
                choices = analytes
    )
    
  })
  
  output$stringInput <- renderUI({
    
    dateString = format(input$date, format="%Y%m%d")
    project = input$project
    
    techName = input$technique
    techNode = Navigate(D831, techName)
    techName = techNode$tag
    
    methodName = input$method
    methodNode = Navigate(techNode, methodName)
    methodName = methodNode$tag
    
    analyteName = input$analyte
    analyteNode = Navigate(methodNode, analyteName)
    analyteName = analyteNode$tag
    
    textInput(inputId = "string",
              label = "Experiment Name",
              value = paste(dateString, project, techName, methodName, analyteName, sep = "_")
    )
  })

}

# Run the application 
shinyApp(ui = ui, server = server)
```














